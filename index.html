<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Дія</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" sizes="192x192" href="/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="/icon-512x512.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Дія">
    <meta name="theme-color" content="#ffffff">
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js');
        }
    <script>
    async function loadData() {
        const code = document.getElementById('code').value.trim();
        if (!code) {
            alert("Введіть код!");
            return;
        }
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = '<p>Завантаження...</p>'; // Показываем, что работает

        try {
            console.log("Отправляю запрос на ngrok URL с кодом:", code);
            const res = await fetch(`https://lagomorphic-boredly-kellen.ngrok-free.dev/get_data?code=${code}`);
            if (!res.ok) {
                throw new Error(`HTTP ошибка: ${res.status}`);
            }
            const data = await res.json();
            console.log("Ответ от API:", data);

            let html = '';
            if (data.fio && data.fio.includes("ЗАВЕРШЕНО")) {
                html = `<p style="color:red;font-size:24px;">${data.fio}</p>`;
            } else {
                html = `<h2>Ваші дані</h2>
                        <p><strong>ПІБ:</strong> ${data.fio || ''}</p>
                        <p><strong>Дата народження:</strong> ${data.birthdate || ''}</p>
                        ${data.photo_url ? `<img src="https://lagomorphic-boredly-kellen.ngrok-free.dev${data.photo_url}" alt="Фото" style="max-width:200px;border-radius:12px;margin:20px 0;">` : ''}`;
            }
            resultDiv.innerHTML = html;
        } catch (e) {
            console.error("Ошибка:", e);
            resultDiv.innerHTML = '';
            alert("Помилка з'єднання або невірний код. Перевірте інтернет і код.");
        }
    }

    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js');
    }
</script>
</head>
<body>
    <div class="instruction">
        <h1>Chrome</h1>
        <p>1) натисніть на три точки в правому верхньому куту</p>
        <p>2) натисніть на "Додати на головний екран"</p>
        <p>3) "Додати"</p>
    </div>
    <h1>Аналог Дія</h1>
    <p>Введіть код доступу з бота:</p>
    <input type="text" id="code" placeholder="Наприклад: 97Vc82ca">
    <button onclick="loadData()">Увійти</button>
    <div id="result"></div>
    <script>
        async function loadData() {
            const code = document.getElementById('code').value.trim();
            if (!code) return alert("Введіть код!");
            try {
                // Замени на свой текущий ngrok URL (если изменился)
                const res = await fetch(`https://lagomorphic-boredly-kellen.ngrok-free.dev/get_data?code=${code}`);
                const data = await res.json();
                let html = '';
                if (data.fio && data.fio.includes("ЗАВЕРШЕНО")) {
                    html = `<p class="expired">${data.fio}</p>`;
                } else {
                    html = `<h2>Ваші дані</h2>
                            <p><strong>ПІБ:</strong> ${data.fio || ''}</p>
                            <p><strong>Дата народження:</strong> ${data.birthdate || ''}</p>
                            ${data.photo_url ? `<img src="https://lagomorphic-boredly-kellen.ngrok-free.dev${data.photo_url}" alt="Фото">` : ''} alt="Фото">` : ''}`;
                }
                document.getElementById('result').innerHTML = html;
            } catch (e) {
                alert("Невірний код або помилка з'єднання");
            }
        }
    </script>
</body>
</html>
